[돌아가기](./README.md)

# 교착상태(DeadLock)

프로세스가 자원을 얻지 못해서 영원히 오지 않는 다음 이벤트를 기다리는 교착 상태

### 교착상태 발생 경우

한정된 자원을 여러 프로세스에서 사용할 때 발생

서로 다른 두 자원을 각각 사용하던 두 프로세스가 서로의 자원을 동시에 원하는 경우

→ 서로에게 자원이 할당되어 있기 때문에 무한정 기다리게 됨

## 교착상태 발생 조건

다음의 4가지 조건을 만족할 때, 교착상태(deadlock) 발생

→ 단 1가지라도 성립하지 않는다면 극복 가능

### 상호 배제 (mutual exclusion)

프로세스가 어떤 자원을 사용할 때, 다른 프로세스를 배제한다

### 점유 대기 (hold and wait)

최소 하나의 자원을 점유하면서, 다른 프로세스가 사용하는 자원을 추가로 점유하려고 대기하는 프로세스가 있다

### 비선점 (no preemption)

프로세스에 할당된 자원은 사용이 끝날 때까지 선점(갈취) 불가능하다

### 순환 대기 (circular wait)

각 프로세스가 다른 프로세스가 점유한 자원을 사용하기 위해 대기하는데, 이 형태가 cycle을 이루고 있다

P0 → P1, P1 → P2, ... , Pn-1 → Pn, Pn → P0

# 교착 상태 처리 방법

## 예방 및 회피 (Prevention and Avoidance)

### 예방법 (Prevention)

`교착상태 발생 전 예방`

교착 상태 발생 조건(상호배제, 점유대기, 비선점, 순환대기) 중 일부를 제거하는 방법

→ 자원 낭비가 심하다

- 상호배제 부정

    여러 프로세스가 공유 자원을 사용하도록 설정

- 점유대기 부정

    어떤 프로세스가 필요로 하는 자원을 실행하기 전에 미리 전부 할당 받도록 설정

- 비선점 부정

    자원을 사용하던 프로세스는 자신이 점유하던 자원을 반납한 후 다른 요구 자원을 대기하도록 설정

- 순환대기 부정

    자원에 각각 고유 번호 할당 및 번호 순서대로 자원을 요구하도록 설정

### 회피법 (Avoidance)

`교착상태 발생 전 회피`

- 은행원 알고리즘

    시스템은 프로세스에게 요구 자원을 할당한 후에 안정 상태로 남아있게 되는지 사전에 검사

    → 안정상태를 할당 전에 검사하는 것을 통해 교착상태를 미리 회피

    1. 자원 할당 후 안정 상태라면 자원 할당
    2. 자원 할당 후 안정 상태가 아니라면, 다른 프로세스들이 자원 해지할 때까지 대기

    → 교착 상태 예방 및 회피 프로토콜을 이용하는 방법

## 탐지 및 회복 (Detection and Recovery)

### 탐지 (Detection)

`교착상태 탐지`

자원 할당 그래프를 이용하여 교착 상태를 탐지한다

**자원 할당 그래프?**

프로세스와 자원을 노드로 나타내어 현재 프로세스가 할당받은 자원의 관계도를 나타낸 그래프

- 노드

    `프로세스` → 원 노드

    `자원` → 사각형 노드

- 엣지

    `프로세스` → `자원` : 프로세스가 어떤 자원을 요청하는 상태를 나타내는 엣지

    `자원` → `프로세스` : 자원이 어떤 프로세스에 이미 할당된 상태를 나타내는 엣지

⇒ 자원 요청 때마다 탐지 알고리즘 실행하면 성능의 오버헤드 발생

### 회복 (Recovery)

`교착상태 발생 후 회복`

교착 상태를 일으킨 프로세스 종료 또는 할당 자원 해제를 통해 교착상태 회복

- 프로세스 종료 방법
    - 교착 상태에 빠진 모든 프로세스 중지
    - 교착 상태가 제거될 때까지 프로세스를 하나씩 중지
- 자원 해제(선점) 방법
    - 교착 상태의 프로세스가 점유한 자원을 선점하여 다른 프로세스에 할당 및 해당 프로세스 일시 정지
    - 우선 순위가 낮거나, 수행된 횟수가 적은 프로세스를 우선적으로 자원을 선점
