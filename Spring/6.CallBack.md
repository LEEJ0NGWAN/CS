[돌아가기](./README.md)

# 빈 생명 주기 콜백

객체는 DB 연결 풀이나 네트워크 소켓처럼, 외부 연결을 위해 애플리케이션 시작 시 미리 연결 설정하고 종료 시 모두 종료시키기 위해 객체 초기화 및 종료 작업이 필요하다

### DB connection pool (DBCP)

미리 DB와 연결을 여러개 만들어 pool에 저장해두고, DB 접근 때 pool에서 꺼내쓰고 다시 pool에 반환하는 기법

## 스프링 빈의 생명 주기

객체 생성 → 의존관계 주입 (단, 생성자 주입은 바로 빈이 주입되므로 제외)

객체 생성 후 의존관계를 주입 받은 다음에 데이터를 사용할 수 있는 준비가 완료됨

→ 객체 초기화 작업은 의존 관계 주입 완료 후 호출될 필요가 있음

**객체 초기화?**

객체에 필요한 값이 전부(외부 포함) 연결되어 있고, 작업을 수행할 준비가 되는 것

→ 단순한 객체 생성이 아님

### 콜백 메소드

스프링은 DI 완료 시 스프링 빈에게 콜백으로 객체 초기화 시점을 알려줄 수 있는 다양한 기능 제공

### 소멸 콜백

스프링 컨테이너가 종료되기 직전에 소멸 콜백 제공

# 스프링 빈 이벤트 생명 주기

스프링 컨테이너 생성 → 스프링 빈 생성 → DI → 초기화 콜백 → 애플리케이션 동작 → 소멸 콜백 → 스프링 종료

### 스프링 빈 생성 단계

→ 생성자 주입이 일어남

### DI 단계

→ 메서드 주입, 필드 주입이 일어남

### 초기화 콜백

빈 생성 및 의존관계 주입 후 호출

### 소멸 콜백

빈이 소멸되기 직전에 호출

# 객체 생성과 초기화 분리

생성자는 객체 내부 속성의 설정, 초기화는 외부 커넥션 연결하는 무거운 동작을 수행하도록 분리 권장

→ 유지보수 관점에서 분리하는 것이 좋다

# 빈 생명 주기 콜백

- 인터페이스 (InitializingBean, DisposableBean)
- config에서 초기화 메소드 및 종료 메소드 설정
- `@PostConstruct`, `@PreDestroy`

### 인터페이스

- InitializingBean

    → 초기화 콜백

- DisposableBean

    → 소멸 콜백

- 단점
    - 스프링 전용 인터페이스이므로, 스프링 전용으로 의존
    - 초기화, 소멸 콜백의 이름 변경 불가
    - 수정 불가능한 외부 라이브러리 적용 힘듦
- 요새 거의 안씀

### config 설정

콜백을 설정하고자 하는 빈에 옵션 부여

```jsx
@Bean(initMethod = "init", destroyMethod = "close")
```

- 자유로운 콜백 이름
- 외부 라이브러리에도 적용 가능
- destroyMethod는 디폴트값이 추론

### 애노테이션

- 스프링에서 권고하는 콜백
- 애노테이션이므로 매우 편리
- 스프링에 종속적인 기술이 아님
- 컴포넌트 스캔과 조합이 좋음
- 외부 라이브러리 적용 x
